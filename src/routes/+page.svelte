<script lang="ts">
  import { tweened } from 'svelte/motion';
  import { expoOut } from 'svelte/easing';

  import { startDate, endDate, daysTotal, daysPassed } from '$lib/stores/Dates'
  import { t } from '$lib/i18n'
  
  import DateInput from '$lib/components/DateInput.svelte'
  import StatusCard from '$lib/components/StatusCard.svelte'

  $: percentage = Math.min(Math.round($daysPassed / $daysTotal * 100), 100)

  let weekDay = new Date().getDay() - 1
  let weekDays = ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So']

  let weekDayTweened = tweened(0, {
    delay: 3600,
    duration: 2000,
    easing: expoOut
  })

  $: weekDayTweened.set(weekDay)
</script>

<main>
  <header>
    <h1>{$t('home.title')}</h1>
  </header>
  <div class="kpi-grid">
    <div class="card date-selection">
        <h4>{$t('home.start')}</h4> <DateInput bind:value={$startDate} />
        <h4>{$t('home.end')}</h4> <DateInput bind:value={$endDate} />
    </div>
    <div class="week">
      <StatusCard 
        title={$t('home.week')}
        value={Math.max(0, Math.min(Math.ceil($daysPassed / 7), Math.ceil($daysTotal / 7)))} />
    </div>
    <div class="progress">
      <StatusCard 
        title={$t('home.progress')}
        value={Math.max(0, percentage)} 
        unit="%"
        text={percentage < 100 ? $t('home.progress-messages')[Math.max(0, Math.floor(percentage / 25))] : $t('home.progress-done')}
        delay={800} />
    </div>
    <div class="days-passed">
      <StatusCard 
        title="{$daysPassed >= 0 ? $t('home.already-done') : $t('home.until-start')}" 
        value={Math.abs(Math.min($daysTotal, $daysPassed))} 
        unit={$t('home.days')}
        delay={1600} 
        text={$t('home.already-done-text')} />
    </div>

    <div class="total-days">
      <StatusCard 
        title={$t('home.total')} 
        value={$daysTotal} 
        text={$t('home.total-message')}
        delay={2400} />
    </div>
    <div class="card soon-weekend">
      <h4>{$t('home.soon-weekend')}</h4>
      <span class="week-day-list">
        {#each weekDays as day, i}
          <span class:active-week-day={i <= $weekDayTweened}>{day}</span>
        {/each}
      </span>
      <p>{$t('home.soon-weekend-messages')[weekDay]}</p>
    </div>
  </div>
</main>

<style>
  .week-day-list {
    display: flex;
    justify-content: space-between;
  }

  .week-day-list span {
    font-size: 2rem;
    margin-inline: 2px;
    margin-block: 0;
    color: var(--c-bodyDimmed);
  }

  span.active-week-day {
    color: var(--c-body);
  }
  
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    justify-content: center;
    width: 100%;
    gap: 1rem;
  }

  .kpi-grid > * {
    width: 100%;
  }

  .kpi-grid .date-selection {
    grid-column: 1 / 4;
    display: grid;
    grid-template-columns: 1fr 4fr;
    align-items: center;
    gap: 1rem;
  }

  .kpi-grid .progress {
    grid-column: 2 / 4;
  }

  .kpi-grid .week {
    grid-column: 1 / 2;
  }

  .kpi-grid .days-passed {
    grid-column: 1 / 3;
  }

  .kpi-grid .total-days {
    grid-column: 3 / 4;
  }

  .kpi-grid .soon-weekend {
    grid-column: 1 / 4;
  }
</style>